# 亚龙大模型参数报告

### 摘要

本报告旨在阐述亚龙大模型的选型、性能测试及部署方案。我们选择 **gpt-oss-20B** 作为基准模型，该模型在RAG问答、指令遵循等方面表现出色。性能测试结果表明，模型对知识库内问题的回答能力较强，在有补丁的情况下表现尤为稳定和出色。针对峰值80人同时使用的场景，我们推荐采用以**四卡RTX 3090**为核心的服务器配置，以提供流畅的用户体验。

---

### 1. 基准模型选型

#### 1.1 选定模型
**gpt-oss-20B**

#### 1.2 选型理由
选择 gpt-oss-20B 作为基准模型，主要基于以下优势：
- **卓越的RAG性能**: 在RAG（检索增强生成）问答场景中表现良好，回答风格贴合助手与导师的角色定位。
- **强大的指令遵循能力**: 相较于同类模型（如Qwen系列），其指令遵循能力更强，能更好地约束未知问题的幻觉。
- **先进的技术架构**: 采用了更优的分词器架构和量化策略，兼顾了模型性能与推理效率。
- **理想的参数规模**: 20B的参数量在性能和推理速度之间取得了良好平衡，是当前场景下的“甜点”选择。

---

### 2. 性能评估与测试

#### 2.1 测试方法
本次测试旨在评估模型在特定知识领域内的准确性和鲁棒性。
- **题目来源**: 基于4个领域的专业文档，由AI自动生成57道测试题，并附带参考答案。部分题目存在一定的“幻觉”，用于同步评估模型的通用回答能力。
- **测试流程**:
    1.**第一轮（无补丁）**: 在未提供补丁的情况下进行测试。 
    2.**第二轮（有补丁）**: 针对第一轮中相似度较低的选项，添加补丁后进行第二轮测试。
- **评估标准**: 初步使用嵌入模型计算回答与参考答案的向量相似度以进行筛选，最终由AI重新分析与打分，评估回答的准确性。
- **注意**: 向量相似度并不能用于评估回答的正确与否，这里仅作为简单的筛选手段减少工作量，以及填补数据空白。

- **测试结果**
  - [AI对检索结果的对比分析.md](AI%E5%AF%B9%E6%A3%80%E7%B4%A2%E7%BB%93%E6%9E%9C%E7%9A%84%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90.md)
  - 结果表格文件[yalong_test_results.csv](yalong_test_results.csv)或[yalong_test_results.xlsx](yalong_test_results.xlsx)
  - 原始文档请见 **source_file** 目录
#### 2.2 测试结果与分析
- **测试数据**: 详细的测试结果请见附件。
- **结论**: 亚龙大模型对知识库内的问题具备强大的回答能力。在获得精确上下文（补丁）后，其回答的准确性和稳定性接近完美。同时，得益于基准模型强大的指令遵循能力，仅通过提示词工程（Prompt Engineering）即可有效抑制模型在面对未知或无法回答问题时的幻觉。

#### 2.3 性能基准（Token生成速度）
- **当前开发配置**:
          - **显卡**: NVIDIA GeForce RTX 4090 (24G)
          - **实测速度**: 单请求生成速度约为 **60 tokens/s**，足以满足开发和调试阶段的需求，可作为多人使用场景下用户体验的及格线。

---

### 3. 生产环境部署建议

#### 3.1 适用场景
该配置旨在满足**峰值80人以内**同时在线进行多轮对话的需求，保障流畅的交互体验。

#### 3.2 硬件配置
- **显卡 (GPU)**: 推荐**四卡NVIDIA GeForce RTX 3090 (24G)**方案。
  - **方案对比**:
      - **双卡4090方案**: 理论峰值性能更高，但多卡并行效率受限于消费级平台PCIe通道和通信带宽，且总显存（48G）在长上下文场景支持有限。预计总价4w以内。
      - **四卡3090方案**: 总显存容量巨大（96G），且每两张卡可通过NVLink桥接，形成两个虚拟的48G显存池，对长上下文和复杂并行策略支持更佳。综合性能预计可以达到前者80%以上。预计总价3w以内。
      - 具体的效果推荐先租卡进行压力测试。 
  - **成本与部署**:
    - 如果直接选择整机，前者大约7w-8w,后者大约5w-6w。这里更加推荐后者，不仅适合部署场景，还有价格优势。
    - 4090 48G单卡估计2.5w左右，但是考虑到是魔改卡，所以这里不作为选项。能上双卡4090 48G也是很不错的选择。
    - 两种方案都无需配备机房。

- **CPU**: 建议选用单核性能较强、且能提供充足PCIe通道的HEDT或工作站级CPU，以确保四张显卡全速运行。
      - **可选择方案**: AMD Threadripper 3960X, Intel Xeon W5-3423等（二手市场价格约2k-5k）。

- **内存 (RAM)**: 推荐配置64-128GB。内存规格（DDR4/DDR5）由所选CPU平台决定，通常64GB DDR4即可满足当前需求，并为后续缓存等功能预留空间。预计价格1k-3k。

#### 3.3 架构设计考量：为何引入MinIO
在存储方案上没有采用简单的本地文件夹，为保证服务的**可扩展性、可维护性和长期健壮性**，引入了MinIO对象存储服务。

- **核心思想：解耦存储与计算**
    - 传统的本地文件夹方案将数据与应用服务器强绑定。当未来需要增加服务器以应对更高并发时，多台服务器间的“文件共享”将成为巨大的技术障碍。
    - MinIO将存储能力独立成一个标准化的网络服务。支持所有设备都通过统一的API访问数据，实现了存储与计算的解耦。并且可以直接通过添加硬盘或者添加分布式存储进行扩容。

- **标准化的API接口**
    - 例如，前端可以直接通过预签名URL安全地上传文件至MinIO，而无需经过后端服务器中转，极大提升了大规模文件上传的效率和稳定性。

- **面向生产的数据管理**
    - MinIO提供了生产环境所需的强大数据管理功能，这是本地文件系统所不具备的。包括：
        - **高可用与持久性**: 可通过纠删码等方式构建高可用的分布式存储集群，避免单点故障。
        - **版本控制**: 可防止文件误删或错误覆盖。
        - **事件通知**: 可在文件上传后自动触发后续的清洗和嵌入流程，实现数据处理的完全自动化。
